# ssu_os
2017_OS assignment
## 2번과제
### 개요
   부트로더란 운영체제가 시동되기 이전에 미리 실행되면서 커널이 올바르게 시동되기 위해 필요한 모든 관련 작업을 마무리하고 최종적으로 운영체제를 시동시키기 위한 목적을 가진 프로그램을 말한다.
 부트로더 프로그램은 16비트 단위로 데이터가 처리되는데 리얼모드에서 동작되고 있다. 리얼모드는 80826이후의 x86호환 CPU의 운영방식이다.
  그런데 리얼모드의 여러 가지 한계로 인해 커널 프로그램을 구동할 때에는 운영 모드를 바꾸어 주어야 한다. 여기서 32비트 보호모드로 운영모드를 전환해야한다.
 리얼모드의 한계는 
 1. 메모리보호기능이 없다.
 2. 메모리 가용범위가 적다(1MB)
 3. 0x10단위 이하로 세그먼트 시작주소를 물리메모리 주소로 지정할 수 없다.
 
 그래서 보호모드(32비트 모드)로 전환하며 이 한계들을 극복한다.
 보호모드로 바뀌면서 생긴 것이 GDT, 셀렉터 레지스터, 디스크립터 레지스터이다. 
 GDT는 메모리에 올라와 있어서 운영체제에서 참고하는 부분이고, 바이너리에서 특정 세그먼트에 접근 할 때 그 해당 셀렉터 레지스터에 설정된 인덱스를 확인하여 GDT에서 해당 세그먼트 디스크립터를 찾는다. 하지만 여기서 셀렉터 레지스터의 DPL과 세그먼트 디스크립터의 DPL을 확인하여 같은 권한을 가지고 있을 때만 디스크립터 레지스터로 세그먼트 디스크립터를 불러온다.
### 설계
video, RTC관련 바이오스 인터럽트를 이용하여 현재 날짜를 출력하여야 한다. 먼저 RTC 관련 바이오스 인터럽트는 1Ah이다. ah 레지스터에 04h를 넣고 인터럽트를 호출하면 ch에는 century의 값이 cl에는 year. dh에는 month, dl에는 day의 값이 들어간다. 이때 들어가는 값이 2017년이면 ch에는 20h, cl에는 17이라는 16진수의 값이 들어간다. 그래서 이러한 16진수의 값을 각각 20과 17에 대응하도록 변경하여야한다.
 video 인터럽트는 int 10h 16번째 인터럽트 벡터이다. 입력값으로 AH = 13h, AL = 쓰기 모드, BH = 페이지, BL = 색, CX = 길이, DH = Row, DL = Column, ES:BP = 오프셋을 넣어주면 문자열을 ES가 가리키는 곳의 문자열을 쓸 수 있다. 
 RTC 인터럽트로 받아온 시간 값을 ES에 집어넣고 VIDEO 인터럽트를 호출하여 화면에 출력하여야 한다.
 구현한 레이블 GET_DATE, SAVE_ES, LEFT_LOOP, RIGHT_LOOP, PRINT_DATE이 있다.
 GET_DATE는 RTC인터럽트로 시간값을 가져오기
 SAVE_ES는 LEFT_LOOP, RIGHT_LOOP를 차례로 호출한다.
 LEFT_LOOP는 ES에 시간 값을 가진 레지스터의 왼쪽 4비트를 넣기
 RIGHT_LOOP는 ES에 시간 값을 가진 레지스터의 오른쪽 4비트 넣기
 PRINT_DATE는 VIDEO 인터럽트를 호출하여 날짜출력하기
 ### 구현방법
  GET_DATE: 라는 레이블에는 ah에 0x04를 넣고 int 0x1a로 인터럽트를 호출한다. 인터럽트가 호출되고 나면 ch, cl, dh, dl에는 시간 값이 16진수로 들어가 있다.
 VIDEO 인터럽트 호출 시 문자열이 들어갈 ES레지스터에 문자열을 넣어주기 위해 아스키코드 값으로 변환 시켜주어야 한다.
 SAVE_ES는 네 개의 레지스터를 순서대로 ES에 저장하는 레이블을 호출한다.
 LEFT_LOOP : ah에는 ch의 20h(0010 0000)가 들어있다. 이때 0010을 2로 저장하기 위한 아스키 코드 값 50으로 만들기 위해 오른쪽으로 4비트를 쉬프트하고 48을 더해준다. 그러면  0011 0010 이라는 값이 ah에 들어가고 이 값을 ES에 넣는다.
 RIGHT_LOOP : ah에는 ch의 20h(0010 0000)가 들어있다. 이때 0000을 0으로 저장하기 위해 왼쪽으로 4비트 쉬프트 해서 0000 0000 으로 만들고 이때 우리가 필요로 하는 값이 왼쪽 4비트에 있으므로 다시 오른쪽으로 4비트를 쉬프트한다. 이 값에 48을 더해 0011 0000 값을 ES에 넣어준다. 그러면 이제 ES에는 2 0을 가리키는 아스키코드 값이 들어가 있다.
PRINT_DATE : int 10h를 호출하기 위한 입력값을 설정한다.  화면 상단 중앙에 출력하기 위해 dh 0, dl 40 (화면의 크기가 80임으로)을 넣어준다. 글자색의 변경을 위해 bl에는 명세대로 0x0e의 속성을 넣어주고 글자 길이가 8자리임으로 cx 8을 넣어준 뒤 인터럽트를 호출하면 화면에 날짜가 출력된다.
